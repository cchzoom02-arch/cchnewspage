<!doctype html>
<html lang="zh-Hant">
 <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>新聞發布業務進度</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;800&amp;display=swap" rel="stylesheet">
  <style>
  body {
    box-sizing: border-box;
  }
  :root{
    --ink:#111111;
    --muted:#6B7280;
    --line:#E6E6E6;
    --accent:#D80000;
    --soft-red:#FFFAFA;
    --soft-red-line:#FFDDDD;
    --blue:#2563EB;
    --green:#059669;
    --purple:#7C3AED;
    --soft-purple:#F8F5FF;
    --soft-purple-line:#E0D4FF;
  }
  *{box-sizing:border-box}
  body{
    font-family:"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;
    color:var(--ink); background:#fff; margin:0; line-height:1.5;
  }
  .wrap{max-width:1200px;margin:40px auto;padding:0 24px}
  h1{font-weight:800;font-size:52px;letter-spacing:.5px;text-align:center;margin:0 0 28px}
  
  /* 原始卡片樣式 */
  .card{
    display:grid; grid-template-columns:140px 1fr 240px; gap:24px;
    border:2px solid var(--line); border-radius:16px; padding:16px 20px; margin:0 0 20px;
    background:#fff; position:relative;
  }
  .card.accent{border-color:var(--soft-red-line); background:var(--soft-red)}
  .card.purple{border-color:var(--soft-purple-line); background:var(--soft-purple)}
  .date{
    padding-right:20px; border-right:2px solid var(--line);
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    text-align:center;
  }
  .date .label,.date .weekday{font-size:14px;color:var(--muted);letter-spacing:1px}
  .date .day{font-size:56px;font-weight:800;line-height:1}
  .card.accent .date .label,
  .card.accent .date .day,
  .card.accent .date .weekday{color:var(--accent)}
  .card.purple .date .label,
  .card.purple .date .day,
  .card.purple .date .weekday{color:var(--purple)}
  .content{display:flex; align-items:center}
  .content h2{margin:0; font-size:40px; line-height:1.15; font-weight:800}
  .content h2.red{color:var(--accent)}
  .content h2.purple{color:var(--purple)}
  .meta{
    padding-left:20px; border-left:2px solid var(--line);
    background:#F7F7F7; border-radius:12px; padding:12px 16px; display:flex; flex-direction:column; justify-content:center
  }
  .meta .row{margin:4px 0; font-size:16px}
  .meta .key{color:var(--muted); margin-right:6px}

  /* 管理功能樣式 */
  .admin-btn{
    position:fixed; top:20px; right:20px; 
    background:var(--blue); color:white; border:none; padding:12px 20px; 
    border-radius:8px; cursor:pointer; font-size:14px; font-weight:600;
    box-shadow:0 4px 12px rgba(37,99,235,0.3); z-index:100;
  }
  .admin-btn:hover{background:#1d4ed8}

  .edit-btn{
    position:absolute; top:16px; right:16px;
    background:var(--green); color:white; border:none; padding:8px 12px;
    border-radius:6px; cursor:pointer; font-size:12px; opacity:0; transition:opacity 0.3s;
    display:none;
  }
  .admin-mode .edit-btn{opacity:1; display:block}
  .edit-btn:hover{background:#047857}

  .add-btn{
    background:var(--blue); color:white; border:none; padding:16px 32px;
    border-radius:12px; cursor:pointer; font-size:16px; font-weight:600;
    margin:20px auto; display:none; box-shadow:0 4px 12px rgba(37,99,235,0.3);
  }
  .admin-mode .add-btn{display:block}
  .add-btn:hover{background:#1d4ed8}

  /* 模態框樣式 */
  .modal{
    display:none; position:fixed; top:0; left:0; width:100%; height:100%;
    background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;
  }
  .modal.show{display:flex}
  .modal-content{
    background:white; padding:32px; border-radius:16px; width:500px; max-width:90%;
    box-shadow:0 20px 60px rgba(0,0,0,0.3); max-height:90vh; overflow-y:auto;
  }
  .modal h3{margin:0 0 24px; font-size:24px; text-align:center; font-weight:800}
  
  .form-group{margin:20px 0}
  .form-group label{display:block; margin-bottom:8px; font-weight:600; color:var(--ink)}
  .form-group input, .form-group select, .form-group textarea{
    width:100%; padding:12px 16px; border:2px solid var(--line); border-radius:8px;
    font-size:16px; font-family:inherit; transition:border-color 0.3s;
  }
  .form-group input:focus, .form-group select:focus, .form-group textarea:focus{
    outline:none; border-color:var(--blue);
  }
  .form-group textarea{resize:vertical; min-height:100px}
  
  .btn{
    background:var(--blue); color:white; border:none; padding:12px 24px;
    border-radius:8px; cursor:pointer; font-size:16px; font-weight:600; margin:8px 4px;
    transition:background-color 0.3s;
  }
  .btn:hover{background:#1d4ed8}
  .btn.secondary{background:var(--muted)}
  .btn.secondary:hover{background:#4b5563}
  .btn.danger{background:var(--accent)}
  .btn.danger:hover{background:#b91c1c}

  /* 人員管理樣式 */
  .staff-section{
    margin:24px 0; padding:20px; background:#f8f9fa; border-radius:12px;
  }
  .staff-section h4{margin:0 0 16px; font-size:18px; font-weight:600}
  .staff-list{
    display:grid; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr)); gap:12px; margin:16px 0;
  }
  .staff-item{
    background:white; padding:12px 16px; border-radius:8px; border:1px solid var(--line);
    display:flex; justify-content:space-between; align-items:center;
  }
  .remove-staff{
    background:var(--accent); color:white; border:none; padding:6px 12px;
    border-radius:4px; cursor:pointer; font-size:12px;
  }
  .remove-staff:hover{background:#b91c1c}

  /* 檔案上傳樣式 */
  .file-upload{
    border:2px dashed var(--line); border-radius:8px; padding:30px;
    text-align:center; cursor:pointer; transition:all 0.3s;
    background:#fafafa;
  }
  .file-upload:hover{border-color:var(--blue); background:#f0f8ff}
  .file-upload input{display:none}
  .file-upload p{margin:0; color:var(--muted)}
  .file-upload small{color:var(--muted); font-size:12px}

  .checkbox-group{
    display:flex; align-items:center; gap:8px; margin:16px 0;
  }
  .checkbox-group input[type="checkbox"]{
    width:auto; margin:0;
  }

  @media (max-width:900px){
    .card{grid-template-columns:1fr; }
    .date{border-right:0; border-bottom:2px solid var(--line); padding-bottom:12px; margin-bottom:8px}
    .meta{border-left:0; margin-top:8px}
    .content h2{font-size:28px}
    .date .day{font-size:42px}
    .modal-content{width:95%; padding:20px}
    .admin-btn{position:static; margin:20px auto; display:block; width:fit-content}
  }
</style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body><button class="admin-btn" onclick="showLoginModal()">管理後台</button>
  <div class="wrap">
   <h1>新聞發布業務進度</h1>
   <div style="text-align:center; margin:20px 0"><button class="add-btn" onclick="addNews()">+ 新增新聞</button> <button class="add-btn" onclick="showHistoryModal()" style="background:var(--muted); margin-left:12px">📚 歷史紀錄</button>
   </div>
   <div id="newsContainer"></div>
  </div><div id="loginModal" class="modal">
   <div class="modal-content">
    <h3>🔐 管理員登入</h3>
    <div class="form-group"><label>請輸入管理密碼：</label> <input type="password" id="adminPassword" placeholder="請輸入密碼" onkeypress="if(event.key==='Enter') login()">
    </div>
    <div style="text-align:center"><button class="btn" onclick="login()">登入</button> <button class="btn secondary" onclick="closeModal('loginModal')">取消</button>
    </div>
   </div>
  </div><div id="editModal" class="modal">
   <div class="modal-content">
    <h3 id="editTitle">編輯新聞</h3>
    <div class="form-group"><label>📅 發布日期：</label> <input type="date" id="editDate" required>
    </div>
    <div class="form-group"><label>📰 新聞標題：</label> <textarea id="editNewsTitle" placeholder="請輸入新聞標題" required></textarea>
    </div>
    <div class="form-group"><label>✏️ 編輯人員：</label> <select id="editEditor" required> <option value="">請選擇編輯人員</option> </select>
    </div>
    <div class="form-group"><label>🎬 影片人員：</label> <select id="editVideo" required> <option value="">請選擇影片人員</option> </select>
    </div>
    <div class="form-group"><label>🎨 平面人員：</label> <select id="editGraphic" required> <option value="">請選擇平面人員</option> </select>
    </div>
    <div class="checkbox-group"><input type="checkbox" id="editAccent"> <label for="editAccent">⭐ 重點新聞（紫色標示）</label>
    </div>
    <div style="text-align:center; margin-top:32px"><button class="btn" onclick="saveNews()">💾 儲存</button> <button class="btn danger" onclick="deleteNews()" id="deleteBtn">✅ 完成新聞</button> <button class="btn secondary" onclick="closeModal('editModal')">取消</button>
    </div>
   </div>
  </div><div id="historyModal" class="modal">
   <div class="modal-content" style="width:900px; max-width:95%; max-height:90vh">
    <h3>📚 新聞歷史紀錄</h3><div class="staff-section">
     <h4>🔍 搜尋條件</h4>
     <div style="display:grid; grid-template-columns:1fr 1fr 2fr auto; gap:12px; margin-bottom:16px"><select id="searchYear"> <option value="">選擇年份</option> </select> <select id="searchMonth"> <option value="">選擇月份</option> <option value="1">1月</option> <option value="2">2月</option> <option value="3">3月</option> <option value="4">4月</option> <option value="5">5月</option> <option value="6">6月</option> <option value="7">7月</option> <option value="8">8月</option> <option value="9">9月</option> <option value="10">10月</option> <option value="11">11月</option> <option value="12">12月</option> </select> <input type="text" id="searchKeyword" placeholder="輸入關鍵字搜尋標題內容..."> <button class="btn" onclick="searchHistory()">搜尋</button>
     </div>
     <div style="text-align:center"><button class="btn secondary" onclick="clearSearch()" style="font-size:14px; padding:8px 16px">清除條件</button> <span id="searchResults" style="margin-left:16px; color:var(--muted); font-size:14px"></span>
     </div>
    </div><div class="staff-section">
     <h4>📰 歷史新聞 (<span id="historyCount">0</span>)</h4>
     <div id="historyList" style="max-height:400px; overflow-y:auto; border:1px solid var(--line); border-radius:8px; padding:16px; background:white"></div>
    </div>
    <div style="text-align:center; margin-top:32px"><button class="btn" onclick="downloadHistoryExcel()" style="background:var(--green); margin-right:12px">📥 下載Excel</button> <button class="btn secondary" onclick="closeModal('historyModal')">關閉</button>
    </div>
   </div>
  </div><div id="staffModal" class="modal">
   <div class="modal-content" style="width:800px; max-width:95%">
    <h3>👥 管理後台</h3><div class="staff-section">
     <h4>📰 新聞管理</h4>
     <div style="text-align:center; margin:16px 0"><button class="btn" onclick="addNews()">➕ 新增新聞</button>
     </div>
     <div id="adminNewsList" style="max-height:300px; overflow-y:auto; border:1px solid var(--line); border-radius:8px; padding:16px; background:white"></div>
    </div>
    <div class="staff-section">
     <h4>📊 Excel檔案匯入</h4>
     <div class="file-upload" onclick="document.getElementById('excelFile').click()"><input type="file" id="excelFile" accept=".xlsx,.xls,.csv" onchange="importExcel(event)">
      <p>📁 點擊上傳Excel檔案</p><small>支援格式：.xlsx, .xls, .csv<br>
       欄位：員工編號、姓名、職位（編輯/影片/平面）</small>
     </div>
    </div>
    <div class="staff-section">
     <h4>➕ 手動新增人員</h4>
     <div style="display:grid; grid-template-columns:1fr 1fr 1fr auto; gap:12px; margin-bottom:16px"><input type="text" id="staffId" placeholder="員工編號"> <input type="text" id="staffName" placeholder="姓名"> <select id="staffRole"> <option value="editor">編輯</option> <option value="video">影片</option> <option value="graphic">平面</option> </select> <button class="btn" onclick="addStaff()">新增</button>
     </div>
    </div>
    <div class="staff-section">
     <h4>✏️ 編輯人員 (<span id="editorCount">0</span>)</h4>
     <div id="editorList" class="staff-list"></div>
    </div>
    <div class="staff-section">
     <h4>🎬 影片人員 (<span id="videoCount">0</span>)</h4>
     <div id="videoList" class="staff-list"></div>
    </div>
    <div class="staff-section">
     <h4>🎨 平面人員 (<span id="graphicCount">0</span>)</h4>
     <div id="graphicList" class="staff-list"></div>
    </div>
    <div style="text-align:center; margin-top:32px"><button class="btn" onclick="closeModal('staffModal')">✅ 完成</button>
    </div>
   </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
// 初始資料
let newsData = [
  {
    id: 1,
    date: '2024-08-12',
    title: '彰基攜手中興大學醫學院　傳承醫療使命、落實在地關懷',
    editor: '109899',
    video: '155125',
    graphic: '180712',
    accent: true
  },
  {
    id: 2,
    date: '2024-08-13',
    title: '鹿港基督教醫院防颱速報　致贈科技沙包防範楊柳颱風侵襲',
    editor: '53620',
    video: '155125',
    graphic: '72760',
    accent: false
  },
  {
    id: 3,
